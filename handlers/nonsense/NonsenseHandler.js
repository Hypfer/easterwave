import Handler from "../Handler.js";

/*
++++++#@@@@%+++++++*##++========================================------==================+===============================
++++++*@@@@@@*++++++*##++==================================-------------================+===============================
+++++++@@@@@@%#++++++*##++=======-=====-===============------------------===============+======================-========
+++++++@@@@@@@%*++++++###++==========================-----------------==================+===============================
++++++*@@@@@@@@%*++++++###+=========================------------========================+===============================
++++++#@@@@@@@@@#++++#*###++==-=========================================================================================
:+++++*@@@@@@@@@%*++##**##++--=====================================================---=-================================
:=++++#@@@@@@@@@@#++++*+###+===================*================================-------=+===============================
:::++=*@@@@@@@@%##++++++###++===========%%#%===%%#============================---------=+===============================
:::#+=#@@@@@@#####++++++###++===========##%@#-#+%%+===========================--------==+===============================
-::*#*#@@@@###%++++++++++##++=============+*+*@**++%====================================+===============================
*::**+*%@####++=+=*++++++##*+-============#++++#+++++#==================+===============+===============================
#-:++*#%*#%#====+=*++++++##*+-====--------@++++%+++++++=================##*=============+===============================
%#:+==+#%+-=+====+#++++++###+--------------#+++%++++++@=================*+#*============+===============================
%#=+===**=-----++=#++++++###+--------=----=#++++*+++++*-===============+++=*++==========+===============================
*##*===*+---%%==-##+++++*###+====-=-----====#+++@++++++=--============+*=+-=*++=========+===============================
+**===+*+-:%%%%--+#++++++###+=========-=====#+++@++++++*###******############*####*#######%####*========================
======+*+--%%%%--=*++++++##*+=--===========-#%++%++++*+###%%%%@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%###*========================
%%%@@#=**---%%#--=#+++##+#**+=----=========-+%#%#%%*-#@*##%%%%%%#########=-++########%##%%%%#*#*========================
@@@@%%%%%+=------=+*+***+#**+------=========+++#+*#%%%####%%%%%%########++##:########%####%%*##*========================
@@@@@@@%%********=+**++++#**+------=======+++***++++*%#*#*%%############**##=##############%*##*========================
@@@@@@@%%+==+++++=#++++++##*+----========#+++%+++++%--**##%###############**###############%**#*========================
%@@@@@@%%+========*++++++##@*==+#%%%%+=-#++%+++++#+---#*##%++######++##+#:*###%#*##%#######%*##*======--================
@@@@@@@%%+========#++++*+@**************%@+++++@------#*##%:#*---##-##%-::+##+%--%*=#=-#=*#%**#*===============---------
@@@@@@@%%*========#++%***************%%+++++%=========%*##%--*#=#=+:+##:#--**+#+=#-:#::#=*##**#*=============-------====
@%%@@@@%%*========@******************%*%#*#*%=========%*##%#################################**#*===============----=====
@@@@@@@%%*=======%*************************@%%%=======**##%%#:-=#-:=*-#-:#++::#:#:+*##--=######*===============---======
@@@@@@@%%+======%**************************@-+%=------**##%%%:#:#:#:**:=##=*:*#=::##-#=######*#*==============----======
@@@@@@@%%+====%********************#%%#****@--+@------#*##%%#:#+#-:-##*+*###::*+#=*-+#--:%###*#*=============----=-=====
%**+%%@%%+==#---#%***************************=-=------#*##%%##%####%%###%%%%%%%%%%%%#########*#*=============------=====
*++++%%%%==@--------%***********************@------===##*#######*******#####*****#**###########*============--------====
+++++%%%%+*------------%********%***********=---======+###########**#*###########%%%%#########**================---=====
++*+%%%%%*---------------*#****************%-==========================================================---==============
#**%@@@@*-------------------+%************@-===========================================================------===========
%@%%%@@%-------------------------+#@%%%%#*--===========================================================-----============
@%%%%@@------------------------------#---**-==========================================================------============
%%%%%@-------------------------------=---+@-========================================================------==============
 */

const NONSENSE_COMMAND_REGEX = /!(?<command>nonsense|nonsensecount|nonsensecounter)(?:\s|$)/;

class NonsenseHandler extends Handler {
    /**
     *
     * @param {object} options
     * @param {import("../util/Counter")} options.nonsenseCounter
     */
    constructor(options) {
        super();
        
        this.nonsenseCounter = options.nonsenseCounter;
    }

    async handleMessage(ctx) {
        let text;

        if (typeof ctx.update.message?.text === "string") {
            text = ctx.update.message.text;
        } else if (typeof ctx.update.message?.caption === "string") {
            text = ctx.update.message.caption;
        }

        const match =NONSENSE_COMMAND_REGEX.exec(text);

        if(match) {
            try {
                // noinspection FallThroughInSwitchStatementJS
                switch(match.groups.command) {
                    case "nonsense":
                        this.nonsenseCounter.increment();
                    case "nonsensecount":
                    case "nonsensecounter":
                        ctx.sendMessage(`Current Daily Nonsense Counter: ${this.nonsenseCounter.counter}. Last Reset: ${this.nonsenseCounter.lastReset}`);
                        
                        break;
                }
            } catch (e) {
                console.warn(`${new Date().toISOString()} - Error while executing nonsense command`, e);
            }
        }
    }
}

export default NonsenseHandler;
