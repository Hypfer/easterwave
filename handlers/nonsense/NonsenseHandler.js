import Handler from "../Handler.js";

/*
++++++#@@@@%+++++++*##++========================================------==================+===============================
++++++*@@@@@@*++++++*##++==================================-------------================+===============================
+++++++@@@@@@%#++++++*##++=======-=====-===============------------------===============+======================-========
+++++++@@@@@@@%*++++++###++==========================-----------------==================+===============================
++++++*@@@@@@@@%*++++++###+=========================------------========================+===============================
++++++#@@@@@@@@@#++++#*###++==-=========================================================================================
:+++++*@@@@@@@@@%*++##**##++--=====================================================---=-================================
:=++++#@@@@@@@@@@#++++*+###+===================*================================-------=+===============================
:::++=*@@@@@@@@%##++++++###++===========%%#%===%%#============================---------=+===============================
:::#+=#@@@@@@#####++++++###++===========##%@#-#+%%+===========================--------==+===============================
-::*#*#@@@@###%++++++++++##++=============+*+*@**++%====================================+===============================
*::**+*%@####++=+=*++++++##*+-============#++++#+++++#==================+===============+===============================
#-:++*#%*#%#====+=*++++++##*+-====--------@++++%+++++++=================##*=============+===============================
%#:+==+#%+-=+====+#++++++###+--------------#+++%++++++@=================*+#*============+===============================
%#=+===**=-----++=#++++++###+--------=----=#++++*+++++*-===============+++=*++==========+===============================
*##*===*+---%%==-##+++++*###+====-=-----====#+++@++++++=--============+*=+-=*++=========+===============================
+**===+*+-:%%%%--+#++++++###+=========-=====#+++@++++++*###******############*####*#######%####*========================
======+*+--%%%%--=*++++++##*+=--===========-#%++%++++*+###%%%%@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%###*========================
%%%@@#=**---%%#--=#+++##+#**+=----=========-+%#%#%%*-#@*##%%%%%%#########=-++########%##%%%%#*#*========================
@@@@%%%%%+=------=+*+***+#**+------=========+++#+*#%%%####%%%%%%########++##:########%####%%*##*========================
@@@@@@@%%********=+**++++#**+------=======+++***++++*%#*#*%%############**##=##############%*##*========================
@@@@@@@%%+==+++++=#++++++##*+----========#+++%+++++%--**##%###############**###############%**#*========================
%@@@@@@%%+========*++++++##@*==+#%%%%+=-#++%+++++#+---#*##%++######++##+#:*###%#*##%#######%*##*======--================
@@@@@@@%%+========#++++*+@**************%@+++++@------#*##%:#*---##-##%-::+##+%--%*=#=-#=*#%**#*===============---------
@@@@@@@%%*========#++%***************%%+++++%=========%*##%--*#=#=+:+##:#--**+#+=#-:#::#=*##**#*=============-------====
@%%@@@@%%*========@******************%*%#*#*%=========%*##%#################################**#*===============----=====
@@@@@@@%%*=======%*************************@%%%=======**##%%#:-=#-:=*-#-:#++::#:#:+*##--=######*===============---======
@@@@@@@%%+======%**************************@-+%=------**##%%%:#:#:#:**:=##=*:*#=::##-#=######*#*==============----======
@@@@@@@%%+====%********************#%%#****@--+@------#*##%%#:#+#-:-##*+*###::*+#=*-+#--:%###*#*=============----=-=====
%**+%%@%%+==#---#%***************************=-=------#*##%%##%####%%###%%%%%%%%%%%%#########*#*=============------=====
*++++%%%%==@--------%***********************@------===##*#######*******#####*****#**###########*============--------====
+++++%%%%+*------------%********%***********=---======+###########**#*###########%%%%#########**================---=====
++*+%%%%%*---------------*#****************%-==========================================================---==============
#**%@@@@*-------------------+%************@-===========================================================------===========
%@%%%@@%-------------------------+#@%%%%#*--===========================================================-----============
@%%%%@@------------------------------#---**-==========================================================------============
%%%%%@-------------------------------=---+@-========================================================------==============
 */

const NONSENSE_COMMAND_REGEX = /!(?<command>nonsense|nonsensecount|nonsensecounter)(?:\s|$)/;

class NonsenseHandler extends Handler {
    /**
     *
     * @param {object} options
     * @param {import("../util/Counter")} options.nonsenseCounter
     */
    constructor(options) {
        super();

        this.nonsenseCounter = options.nonsenseCounter;
    }

    async handleMessage(ctx) {
        const message = ctx.update.message || ctx.update.edited_message;
        let text;

        if (typeof message?.text === "string") {
            text = message.text;
        } else if (typeof message?.caption === "string") {
            text = message.caption;
        }

        const match = NONSENSE_COMMAND_REGEX.exec(text);

        if(match) {
            try {
                // noinspection FallThroughInSwitchStatementJS
                switch(match.groups.command) {
                    case "nonsense":
                        this.nonsenseCounter.increment();
                    case "nonsensecount":
                    case "nonsensecounter":
                        ctx.sendMessage(`Current Daily Nonsense Counter: ${this.nonsenseCounter.counter}. Last Reset: ${this.nonsenseCounter.lastReset}`);

                        break;
                }
            } catch (e) {
                console.warn(`${new Date().toISOString()} - Error while executing nonsense command`, e);
            }
        }
    }
}

export default NonsenseHandler;
